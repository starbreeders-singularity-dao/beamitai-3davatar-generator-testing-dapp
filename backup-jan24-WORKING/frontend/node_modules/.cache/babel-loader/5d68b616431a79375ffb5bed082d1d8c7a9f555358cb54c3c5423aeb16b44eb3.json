{"ast":null,"code":"/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport { AbiError } from 'web3-errors';\nimport { padLeft, toBigInt } from 'web3-utils';\nimport { utils } from 'web3-validator';\nimport { WORD_SIZE } from '../utils.js';\nimport { numberLimits } from './numbersLimits.js';\n// eslint-disable-next-line no-bitwise\nconst mask = BigInt(1) << BigInt(256);\nfunction bigIntToUint8Array(value, byteLength = WORD_SIZE) {\n  let hexValue;\n  if (value < 0) {\n    hexValue = (mask + value).toString(16);\n  } else {\n    hexValue = value.toString(16);\n  }\n  hexValue = padLeft(hexValue, byteLength * 2);\n  return utils.hexToUint8Array(hexValue);\n}\nfunction uint8ArrayToBigInt(value, max) {\n  const hexValue = utils.uint8ArrayToHexString(value);\n  const result = BigInt(hexValue);\n  if (result <= max) return result;\n  return result - mask;\n}\nexport function encodeNumber(param, input) {\n  let value;\n  try {\n    value = toBigInt(input);\n  } catch (e) {\n    throw new AbiError('provided input is not number value', {\n      type: param.type,\n      value: input,\n      name: param.name\n    });\n  }\n  const limit = numberLimits.get(param.type);\n  if (!limit) {\n    throw new AbiError('provided abi contains invalid number datatype', {\n      type: param.type\n    });\n  }\n  if (value < limit.min) {\n    throw new AbiError('provided input is less then minimum for given type', {\n      type: param.type,\n      value: input,\n      name: param.name,\n      minimum: limit.min.toString()\n    });\n  }\n  if (value > limit.max) {\n    throw new AbiError('provided input is greater then maximum for given type', {\n      type: param.type,\n      value: input,\n      name: param.name,\n      maximum: limit.max.toString()\n    });\n  }\n  return {\n    dynamic: false,\n    encoded: bigIntToUint8Array(value)\n  };\n}\nexport function decodeNumber(param, bytes) {\n  if (bytes.length < WORD_SIZE) {\n    throw new AbiError('Not enough bytes left to decode', {\n      param,\n      bytesLeft: bytes.length\n    });\n  }\n  const boolBytes = bytes.subarray(0, WORD_SIZE);\n  const limit = numberLimits.get(param.type);\n  if (!limit) {\n    throw new AbiError('provided abi contains invalid number datatype', {\n      type: param.type\n    });\n  }\n  const numberResult = uint8ArrayToBigInt(boolBytes, limit.max);\n  if (numberResult < limit.min) {\n    throw new AbiError('decoded value is less then minimum for given type', {\n      type: param.type,\n      value: numberResult,\n      name: param.name,\n      minimum: limit.min.toString()\n    });\n  }\n  if (numberResult > limit.max) {\n    throw new AbiError('decoded value is greater then maximum for given type', {\n      type: param.type,\n      value: numberResult,\n      name: param.name,\n      maximum: limit.max.toString()\n    });\n  }\n  return {\n    result: numberResult,\n    encoded: bytes.subarray(WORD_SIZE),\n    consumed: WORD_SIZE\n  };\n}\n//# sourceMappingURL=number.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}