{"ast":null,"code":"/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport { format, isNullish, keccak256 } from 'web3-utils';\nimport { FMT_NUMBER, FMT_BYTES } from 'web3-types';\nimport { decodeFunctionCall, decodeFunctionReturn, encodeEventSignature, encodeFunctionSignature, encodeParameter, encodeParameters, inferTypesAndEncodeParameters, isAbiConstructorFragment, jsonInterfaceMethodToString } from 'web3-eth-abi';\nimport { blockSchema, ALL_EVENTS } from 'web3-eth';\nimport { Web3ContractError } from 'web3-errors';\nexport { decodeEventABI } from 'web3-eth';\nexport const encodeEventABI = ({\n  address\n}, event, options) => {\n  var _a, _b;\n  const topics = options === null || options === void 0 ? void 0 : options.topics;\n  const filter = (_a = options === null || options === void 0 ? void 0 : options.filter) !== null && _a !== void 0 ? _a : {};\n  const opts = {};\n  if (!isNullish(options === null || options === void 0 ? void 0 : options.fromBlock)) {\n    opts.fromBlock = format(blockSchema.properties.number, options === null || options === void 0 ? void 0 : options.fromBlock, {\n      number: FMT_NUMBER.HEX,\n      bytes: FMT_BYTES.HEX\n    });\n  }\n  if (!isNullish(options === null || options === void 0 ? void 0 : options.toBlock)) {\n    opts.toBlock = format(blockSchema.properties.number, options === null || options === void 0 ? void 0 : options.toBlock, {\n      number: FMT_NUMBER.HEX,\n      bytes: FMT_BYTES.HEX\n    });\n  }\n  if (topics && Array.isArray(topics)) {\n    opts.topics = [...topics];\n  } else {\n    opts.topics = [];\n    // add event signature\n    if (event && !event.anonymous && ![ALL_EVENTS, 'allEvents'].includes(event.name)) {\n      opts.topics.push((_b = event.signature) !== null && _b !== void 0 ? _b : encodeEventSignature(jsonInterfaceMethodToString(event)));\n    }\n    // add event topics (indexed arguments)\n    if (![ALL_EVENTS, 'allEvents'].includes(event.name) && event.inputs) {\n      for (const input of event.inputs) {\n        if (!input.indexed) {\n          continue;\n        }\n        const value = filter[input.name];\n        if (!value) {\n          // eslint-disable-next-line no-null/no-null\n          opts.topics.push(null);\n          continue;\n        }\n        // TODO: https://github.com/ethereum/web3.js/issues/344\n        // TODO: deal properly with components\n        if (Array.isArray(value)) {\n          opts.topics.push(value.map(v => encodeParameter(input.type, v)));\n        } else if (input.type === 'string') {\n          opts.topics.push(keccak256(value));\n        } else {\n          opts.topics.push(encodeParameter(input.type, value));\n        }\n      }\n    }\n  }\n  if (!opts.topics.length) delete opts.topics;\n  if (address) {\n    opts.address = address.toLowerCase();\n  }\n  return opts;\n};\nexport const encodeMethodABI = (abi, args, deployData) => {\n  const inputLength = Array.isArray(abi.inputs) ? abi.inputs.length : 0;\n  if (abi.inputs && inputLength !== args.length) {\n    throw new Web3ContractError(`The number of arguments is not matching the methods required number. You need to pass ${inputLength} arguments.`);\n  }\n  let params;\n  if (abi.inputs) {\n    params = encodeParameters(Array.isArray(abi.inputs) ? abi.inputs : [], args).replace('0x', '');\n  } else {\n    params = inferTypesAndEncodeParameters(args).replace('0x', '');\n  }\n  if (isAbiConstructorFragment(abi)) {\n    if (!deployData) throw new Web3ContractError('The contract has no contract data option set. This is necessary to append the constructor parameters.');\n    if (!deployData.startsWith('0x')) {\n      return `0x${deployData}${params}`;\n    }\n    return `${deployData}${params}`;\n  }\n  return `${encodeFunctionSignature(abi)}${params}`;\n};\n/** @deprecated import `decodeFunctionCall` from ''web3-eth-abi' instead. */\nexport const decodeMethodParams = decodeFunctionCall;\n/** @deprecated import `decodeFunctionReturn` from ''web3-eth-abi' instead. */\nexport const decodeMethodReturn = decodeFunctionReturn;\n//# sourceMappingURL=encoding.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}