{"ast":null,"code":"import * as React from 'react';\nimport { useThree } from '@react-three/fiber';\nfunction CycleRaycast({\n  onChanged,\n  portal,\n  preventDefault = true,\n  scroll = true,\n  keyCode = 9\n}) {\n  const cycle = React.useRef(0);\n  const setEvents = useThree(state => state.setEvents);\n  const get = useThree(state => state.get);\n  const gl = useThree(state => state.gl);\n  React.useEffect(() => {\n    var _portal$current;\n    let hits = [];\n    let lastEvent = undefined;\n    const prev = get().events.filter;\n    const target = (_portal$current = portal == null ? void 0 : portal.current) !== null && _portal$current !== void 0 ? _portal$current : gl.domElement.parentNode;\n\n    // Render custom status\n    const renderStatus = () => target && onChanged && onChanged(hits, Math.round(cycle.current) % hits.length);\n\n    // Overwrite the raycasters custom filter (this only exists in r3f)\n    setEvents({\n      filter: (intersections, state) => {\n        // Reset cycle when the intersections change\n        let clone = [...intersections];\n        if (clone.length !== hits.length || !hits.every(hit => clone.map(e => e.object.uuid).includes(hit.object.uuid))) {\n          cycle.current = 0;\n          hits = clone;\n          renderStatus();\n        }\n        // Run custom filter if there is one\n        if (prev) clone = prev(clone, state);\n        // Cycle through the actual raycast intersects\n        for (let i = 0; i < Math.round(cycle.current) % clone.length; i++) {\n          const first = clone.shift();\n          clone = [...clone, first];\n        }\n        return clone;\n      }\n    });\n\n    // Cycle, refresh events and render status\n    const refresh = fn => {\n      var _get$events$handlers, _get$events$handlers2;\n      cycle.current = fn(cycle.current);\n      // Cancel hovered elements and fake a pointer-move\n      (_get$events$handlers = get().events.handlers) == null || _get$events$handlers.onPointerCancel(undefined);\n      (_get$events$handlers2 = get().events.handlers) == null || _get$events$handlers2.onPointerMove(lastEvent);\n      renderStatus();\n    };\n\n    // Key events\n    const tabEvent = event => {\n      if ((event.keyCode || event.which) === keyCode) {\n        if (preventDefault) event.preventDefault();\n        if (hits.length > 1) refresh(current => current + 1);\n      }\n    };\n\n    // Wheel events\n    const wheelEvent = event => {\n      if (preventDefault) event.preventDefault();\n      let delta = 0;\n      if (!event) event = window.event;\n      if (event.wheelDelta) delta = event.wheelDelta / 120;else if (event.detail) delta = -event.detail / 3;\n      if (hits.length > 1) refresh(current => Math.abs(current - delta));\n    };\n\n    // Catch last move event and position custom status\n    const moveEvent = event => lastEvent = event;\n    document.addEventListener('pointermove', moveEvent, {\n      passive: true\n    });\n    if (scroll) document.addEventListener('wheel', wheelEvent);\n    if (keyCode !== undefined) document.addEventListener('keydown', tabEvent);\n    return () => {\n      // Clean up\n      setEvents({\n        filter: prev\n      });\n      if (keyCode !== undefined) document.removeEventListener('keydown', tabEvent);\n      if (scroll) document.removeEventListener('wheel', wheelEvent);\n      document.removeEventListener('pointermove', moveEvent);\n    };\n  }, [gl, get, setEvents, preventDefault, scroll, keyCode]);\n  return null;\n}\nexport { CycleRaycast };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}